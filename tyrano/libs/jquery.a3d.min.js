/**
 *
 * jQuery A3D  v1.0　To use CSS3 Keyframe Animation from JavaScript
 * http://
 * Copyright 2012, ShikemokuMK

 *Free to use and abuse under the MIT license.
 *https://twitter.com/shikemokumk
 *
 */
!function(t){var e=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"moz":/Trident/i.test(navigator.userAgent)?"ms":"opera"in window?"O":"";function a(t){var e={};for(key in t)t[key]=""+t[key],e[key.replace(/^\s+|\s+$/g,"")]=t[key].replace(/^\s+|\s+$/g,"");return e}function n(t,e,a){for(key in t)if("x"==key||"y"==key||"z"==key){var n=t[key];if("="==n.substring(0,1)){var i=parseInt(n.replace("=",""));e[key]=e[key]+i}else if("*"==n.substring(0,1)){i=parseInt(n.replace("*",""));e[key]=i-a[key]}else e[key]=parseInt(n);delete t[key]}return t.translate=e.x+"px,"+e.y+"px",t}t.fn.a3d=function(i){var s=null;return this.each(function(r){var o=this,f=i.frames,c=i.config,l=i.complete,d=i.start,u=i.iteration,m={x:0,y:0,z:0},y="id_"+Math.floor(1e9*Math.random()),p="",h={duration:"4s",state:"running",easing:"0.0,0.0,1.0,1.0",count:"1",delay:"0",direction:"",mode:"forwards",maintain:"true"},g=t.extend(h,a(c)),_="",x="",v={},k={},I=[];if(null!=(s=t.data(this,"base_point")||null)||(s=t.extend({x:0,y:0,z:0},{x:parseInt(t(this).offset().left),y:parseInt(t(this).offset().top)}),t.data(this,"base_point",s)),f["0%"]);else{_=t.data(this,"last_frame_text")||"",x=t.data(this,"last_style_text")||"";var b=t.data(this,"last_mod_frames")||{},z=t.data(this,"last_mod_styles")||{};m=t.data(this,"point")||{x:0,y:0,z:0};var w=" 0%{ -"+e+"-transform:";p=w+=_+"; "+x+"　} ",v=b,k=z}var A=parseInt(g.duration);for(percentage in-1!=g.duration.indexOf("ms")||-1!=g.duration.indexOf("s")&&(A*=1e3),f){var O,S;f[percentage].trans=f[percentage].trans||{},f[percentage].styles=f[percentage].styles||{},O=n(a(f[percentage].trans),m,s),S=a(f[percentage].styles);var M=" "+percentage+"{ -"+e+"-transform:",R="",T="";if(k=t.extend(k,S),v=t.extend(v,O),"true"==g.maintain){for($ in k)T+=" "+$+":"+k[$]+";";for(var $ in v)R+=$+"("+v[$]+") "}else{for($ in S)T+=" "+$+":"+S[$]+";";for(var $ in O)R+=$+"("+O[$]+") "}p+=M+R+"; "+T+"　} ",_=R,"function"==typeof f[percentage].ext&&function(){var t=f[percentage].ext,e=A*parseInt(percentage);I.push(function(){setTimeout(function(){t.call(o)},.01*e)})}()}for($ in I.length>0&&("function"!=typeof d&&(d=function(){}),"function"!=typeof u&&(u=function(){})),t.data(this,"ext_array",I),k)x+=" "+$+":"+k[$]+";";var j=document.styleSheets[document.styleSheets.length-1];j.insertRule("@-"+e+"-keyframes "+y+" {"+p+"} ",j.cssRules.length);var C=t(this);C.a3d_name=y;var E={"-animation-name":C.a3d_name,"-animation-duration":h.duration,"-animation-play-state":h.state,"-animation-delay":h.delay,"-animation-iteration-count":h.count,"-animation-direction":h.direction,"-animation-fill-mode":h.mode,"-animation-timing-function":h.easing},Q={};for(prefix in E)Q["-"+e+prefix]=E[prefix];C.css(Q),t.data(this,"last_frame_text",_),t.data(this,"last_style_text",x),t.data(this,"last_mod_frames",v),t.data(this,"last_mod_styles",k),t.data(this,"point",m),C.css(Q).one(e+"AnimationEnd animationend",function(t){if(C.get(0)!==t.target)return!1;if("function"==typeof l){for(var a in C.css("transform",C.css("transform")),k)C.css(a,C.css(a));C.css("-"+e+"-animation-name",""),l.call(o)}}),C.css(Q).bind(e+"AnimationIteration animationiteration",function(e){if(C.get(0)!==e.target)return!1;"function"==typeof u&&u.call(o);var a=t.data(o,"ext_array");if(a.length>0)for(var n=0;n<a.length;n++)a[n]()}),C.css(Q).one(e+"AnimationStart animationstart",function(e){if(C.get(0)!==e.target)return!1;"function"==typeof d&&d.call(o);var a=t.data(o,"ext_array");if(a.length>0)for(var n=0;n<a.length;n++)a[n]()})})},t.fn.a3dstate=function(a){return this.each(function(n){t(this).css("-"+e+"-animation-play-state",a)})},t.fn.a3dInfo=function(){var e=[];return this.each(function(a){var n=t.data(this,"last_frame_text")||"",i=t.data(this,"last_style_text")||"",s=t.data(this,"last_mod_frames")||{},r=t.data(this,"last_mod_styles")||{},o={point:t.data(this,"point")||{x:0,y:0,z:0},frame_text:n,style_text:i,frames:s,styles:r};e.push(o)}),e},t.fn.a3dChain=function(e,a){e.length;for(var n=0,i=[],s=t(this),r=0;r<e.length;r++){var o=e[r];o.complete=function(){n++,i.length>n?(s.a3d(i[n]),s.a3dstate("running")):"function"==typeof a&&a()},o.config.state="pause",i.push(o)}s.a3d(i[0]),s.a3dstate("running")}}(jQuery);
